<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Ubicaci贸n en tiempo real</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <h2> Mi ubicaci贸n en tiempo real</h2>
    <a href="#" onclick="seguirUbicacion()">Activar seguimiento</a>
    <p id="resultado"></p>
    <div id="mapa" style="width:100%;height:400px;"></div>

    <script>
        function seguirUbicacion() {
            const resultado = document.getElementById("resultado");
            const mapa = document.getElementById("mapa");

            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(
                    function(posicion) {
                        const lat = posicion.coords.latitude;
                        const lon = posicion.coords.longitude;

                        // Mostrar coordenadas en pantalla
                        resultado.innerHTML = `
                            Latitud: ${lat}<br>
                            Longitud: ${lon}
                        `;

                        // Mostrar mapa embebido en tiempo real
                        mapa.innerHTML = `
                            <iframe 
                                width="100%" 
                                height="400" 
                                frameborder="0" 
                                style="border:0" 
                                src="https://www.google.com/maps?q=${lat},${lon}&hl=es&z=15&output=embed" 
                                allowfullscreen>
                            </iframe>
                        `;

                        //  Enviar ubicaci贸n a tu backend en Node.js
                        fetch("http://localhost:3000/ubicacion", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({
                                latitud: lat,
                                longitud: lon,
                                timestamp: new Date().toISOString(),
                                usuario: "Amigo1"
                            })
                        })
                        .then(res => console.log("Ubicaci贸n enviada:", lat, lon))
                        .catch(err => console.error("Error al enviar:", err));
                    },
                    function(error) {
                        const mensajes = {
                            1: "El usuario neg贸 el permiso de ubicaci贸n.",
                            2: "La informaci贸n de ubicaci贸n no est谩 disponible.",
                            3: "La solicitud de ubicaci贸n expir贸.",
                        };
                        resultado.innerHTML = mensajes[error.code] || "Ocurri贸 un error desconocido.";
                    },
                    { enableHighAccuracy: true, maximumAge: 0 }
                );
            } else {
                resultado.innerHTML = "La geolocalizaci贸n no es soportada por este navegador.";
            }
        }
    </script>
</body>
</html>
